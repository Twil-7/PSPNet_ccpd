1、随着卷积神经网络在目标检测任务上的推进，它也开始被用于更精细的图像处理任务：语义分割和实例分割。目标检测只需要预测图像中每个对象的位置和类别，语义分割还要把每个像素都进行分类，而实例分割的任务则更难，要进一步把每个对象的不同实例都区分开。


2、通常，卷积网络由卷积层、下采样层（池化层）和全连接层组成。全卷积网络（Fully Convolutional Network，FCN）是一种没有全连接层的卷积网络，但除了卷积层和下采样层，另外还可以包含上采样层和反卷积层。


3、深刻思考：什么是上采样层？？？什么是反卷积层？？？

常见的上采样方法有双线性插值、转置卷积、上采样（unsampling）和上池化（unpooling）。其中前两种方法较为常见，后两种用得较少。

（1）双线性插值。

双线性插值，又称为双线性内插。在数学上，双线性插值是对线性插值在二维直角网格上的扩展，用于对双变量函数（例如 x 和 y）进行插值。其核心思想是在两个方向分别进行一次线性插值。

在FCN中上采样用的就是双线性插值，双线性插值方法中不需要学习任何参数。

（2）转置卷积。

转置卷积就像卷积一样需要学习参数。转置卷积(Transposed Convolution)常常在一些文献中也称之为反卷积(Deconvolution)和部分跨越卷积(Fractionally-strided Convolution)。如果我们想要我们的网络可以学习到最好地上采样的方法，我们这个时候就可以采用转置卷积。这个方法不会使用预先定义的插值方法，它具有可以学习的参数。

3×3的卷积核是用来连接输入矩阵中的9个值，并且将其转变为输出矩阵的一个值的。一个卷积操作是一个多对一(many-to-one)的映射关系。假设我们想要反过来操作。我们想要将输入矩阵中的一个值映射到输出矩阵的9个值，这将是一个一对多(one-to-many)的映射关系。这个就像是卷积操作的反操作。

我们可以将一个卷积操作用一个矩阵表示。这个表示很简单，无非就是将卷积核重新排列到我们可以用普通的矩阵乘法进行矩阵卷积操作。从本质来说，转置卷积不是一个卷积，但是我们可以将其看成卷积，并且当成卷积这样去用。我们通过在输入矩阵中的元素之间插入0进行补充，从而实现尺寸上采样，然后通过普通的卷积操作就可以产生和转置卷积相同的效果了。

转置卷积会导致生成图像中出现棋盘效应(checkerboard artifacts)，推荐了一种上采样的操作（也就是插值操作），这个操作接在一个卷积操作后面以减少这种现象。


（3）Upsamppling和UpPooling。

unsampling就是将输入feature map中的某个值映射填充到输出上采样的feature map的某片对应区域中，而且是全部填充的一样的值。

unpooling的操作与unsampling类似，区别是unpooling记录了原来pooling是取样的位置，在unpooling的时候将输入feature map中的值填充到原来记录的位置上，而其他位置则以0来进行填充。

也就是说，一个是全赋值成相同的值，另一个是把多余的赋值成0。这种操作也太特么粗糙了吧，实际中效果岂不是很差？？？对比起来还是反卷积和线性插值比较好......


4、传统语义分割方法：

基于CNN的语义分割方法，一般用每个像素周围的图像块作为输入，进行分类训练和预测，计算效率相对较低。而FCN直接把整幅图像作为输入，把人工标签地图label map作为输出，训练一个端到端的网络，可以显著提高语义分割的计算效率和预测性能。



5、用全卷积网络进行图像语义分割的主要缺点，在于缺少合适的策略来使用全局场景分类线索。金字塔场景分析网络（Pyramid Scene Parsing Network，PSPNet）集成了合适的全局特征进行像素预测。

PSPNet在FCN的基础上，将像素级特征扩展到专门设计的全局金字塔池化特征，通过结合局部和全局线索来提高最终预测的可靠性。

PSPNet的特点在于使用了金字塔池化模块（pyramid pooling module）。金字塔池化模块在四个不同的粗细尺度上进行特征融合。最粗尺度对特征图进行全局平均池化，产生单格输出，加细尺度把特征图分成不同子区域并形成不同位置的池化表示。在金字塔模块中，不同尺度级别的输出包含不同大小的特征图，然后低维特征图通过双线性插值进行上采样获得相同大小的特征。最后，不同级别的特征被拼接为最终的金字塔池化全局特征。

--------------------------------------------------------------------------------------
感悟：由PSPNet和U-Net对比图可知，两者的区别就在于特征提取的方式不同，老实说，PSPNet特征提取的效果应该是更佳的，它采用了更多样式的卷积尺寸，提取到的特征更具备多样性。对比起来，U-Net从头到位都是在一个模板上不断上采样特征，相比起来更佳单一了。
--------------------------------------------------------------------------------------

PSPNet的总体结构：首先输入图像通过CNN得到特征图，然后通过金字塔池化模块产生不同的子区域表示，接着通过上采样与特征图的拼接形成包含局部和全局上下文信息的特征表示，最后再经过一个卷积层输出最终的像素预测结果。

金字塔结构的各级分别采用不同大小的池化核pooling kernel，通过一定的步长分析不同的子区域，这些多级核在表示上应该保持一个合理的间隔。在本例中，金字塔池化模块是一个4级结构，其中网格大小分别为1*1、2*2、3*3、6*6。


6、一个更有挑战性的问题是进一步把每个对象的不同实例都区分开来，称为实例分割。实例分割的难点在于，既要正确检测出图像中的所有对象，又要将不同对象精准区分开。

与人们期望的复杂方法有所不同，Mask RCNN掩膜区域卷积网络，是一种简单、灵活、通用且快速的实例分割框架，不仅能够高效地检测目标，而且同时可以给每个实例生成一个高质量的分割掩膜。
